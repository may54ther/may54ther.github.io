---
title: 사용자, 그룹, 권한 설정
authors: "may54ther"
tags:
    - CheatSheet
    - Linux
---

## 사용자 및 그룹 설정

### 그룹 생성 및 삭제

> `/etc/group`, `/etc/gshadow`

-   그룹 생성

```
groupadd [그룹]
```

-   그룹 삭제

```sh
groupdel [그룹]
```

### 사용자 생성 및 삭제

> `/etc/passwd`, `/etc/shadow`

-   사용자 생성

```sh
useradd [사용자]      # 홈 디렉터리 X
adduser [사용자]      # 홈 디렉터리 O
```

-   사용자 삭제

```sh
deluser	[사용자]
deluser	[사용자] --remove-home
```

-   사용자 수정

```sh
usermod [사용자]
# 홈 디렉터리 변경
usermod [사용자] -d [경로] [사용자]
# 계정 잠금 및 해제
usermod -L [사용자]
usermod -u [사용자]
```

-   사용자 암호 설정

```sh
passwd [사용자]
passwd -d [사용자]
```

-   사용자 그룹 설정

```sh
usermod -aG [그룹] [사용자]
gpasswd -d [사용자] [그룹]
```

### 일반 계정에 `sudo` 권한 부여

```sh
su root
sudo usermod -aG sudo [사용자]
```

---

## 시스템 운영

### 프로세스 조회

```sh
# '프로세스명'으로 조회
ps -ef | grep [프로세스명]

# '포트'로 조회
netstat -nltp | grep [포트]
netstat -nltp | grep LISTEN | grep [포트]
```

---

## 네트워크 관리

---

## ...

---

## Commands

### 권한

```sh
# `sudo`로 실행
sudo bash -c "명령어"
sudo bash -c "cd /root && ls"
```

### apt 명령어

```sh
apt-cache search [패키지명] [검색어]
apt search [패키지명] [검색어]

apt list [패키지명]
apt list -upgradable
apt list --installed
apt list [패키지명] --installed
```

### 압축 및 해제

```sh
# .tar
tar -cvf [파일명.tar] [폴더명]
tar -xvf [파일명.tar]

# .tar.gz
tar -zcvf [파일명.tar.gz] [폴더명]
tar -zxvf [파일명.tar.gz]
```

### 프로세스

```sh
ps -ef | grep {검색어}
```

### 포트

```sh
netstat -ntap | grep LISTEN | grep 포트
```

### 방화벽

```sh
sudo iptables -I INPUT  -p tcp --dport 443 -j ACCEPT
sudo iptables -I INPUT  -p tcp --dport 3001 -j ACCEPT
sudo iptables -I INPUT  -p udp --dport 53 -j ACCEPT
sudo iptables -I OUTPUT -p tcp --dport 3001 -j ACCEPT
sudo iptables -I OUTPUT  -p udp --dport 53 -j ACCEPT
sudo iptables -I OUTPUT  -p tcp --dport 53 -j ACCEPT
```

### 네트워크 속도

-   tc (트래픽 제어)
    -   dev eth0`: 사용할 네트워크 인터페이스 (필요시`ip a` 명령어로 확인)
    -   rate 1mbit` : 제한할 속도
    -   burst` : 임시 버스트 허용량
    -   latency` : 최대 지연 허용시간

```sh
# 조회
ip link
# 네트워크 속도 제한
sudo tc qdisc add dev {NETWORK_INTERFACE} root tbf rate 2mbit burst 32kbit latency 100ms
# 네트워크 속도 제한 제거
sudo tc qdisc del dev {NETWORK_INTERFACE} root
```

### 서비스

-   설정 파일

```sh
cd /etc/systemd/system
touch {SERVICE_NAME}.service
```

-   재시동시에도 자동 실행되도록 하기 위해서 아래 명령어로 서비스 등록

```sh
systemctl enabled {SERVICE_NAME}
```

-   실행

```sh
# service
service 서비스명 {start|restart|stop|status}

# systemctl
sudo systemctl {start|restart|stop|status} 서비스명
```

### 네트워크 설정

##### ifupdown

```sh
sudo nano /etc/network/interfaces
```

-   예시

```yml
source /etc/network/interfaces.d/*

auto lo
iface lo inet loopback

# 이더넷 수동 설정
auto ens3
iface ens3 inet static
	address 172.16.3.109          # 원하는 IP
	netmask 255.255.240.0         # 서브넷 마스크
	gateway 172.16.0.1            # 게이트웨이 (공유기 주소)
	dns-nameservers 8.8.8.8       # DNS 서버 (Google Public DNS)
```

-   적용

```sh
systemctl restart networking
```

##### systemd-networkd

```sh
sudo nano /etc/systemd/network/*.network
```

-   설정

```sh
[Match]
Name=eth0

[Network]
Address=192.168.1.100/24
Gateway=192.168.1.1
DNS=8.8.8.8
```

-   확인

```sh
networkctl status
networkctl status {DEVICE_NAME}
networkctl list
```

##### NetworkManager

```sh
# nmcli
nmcli connection add type ethernet ifname eth0 con-name my-ethernet ipv4.addresses 192.168.1.100/24 gw4 192.168.1.1 nmcli connection up my-ethernet

# nmtui
# 해당 명령어를 입력하면 네트워크 설정을 할 수 있는 UI가 터미널에 표시
```

-   적용

```sh
systemctl restart NetworkManager
```

##### Netplan

(ubuntu 17.10 이상, 기본 네트워크 설정 관리자)

```sh
sudo nano /etc/netplan/*.yml
```

-   DHCP

```yml
network:
  version: 2
  renderer: networkd
  ethernets:
	eth0:
	  dhcp4: true
	  dhcp-identifier: mac
```

-   Static IP

```yml
network:
  version: 2
  renderer: networkd
  ethernets:
	eth0:
	  addresses:
		- 192.168.1.100/24
	  gateway4: 192.168.1.1
	  nameservers:
		addresses:
		  - 168.126.63.1
		  - 8.8.8.8
		  - 8.8.4.4
```

-   Wifi

```yml
network:
  version: 2
  renderer: NetworkManager
  wifis:
	wlan0:
	  dhcp4: true
	  access-points:
		"MyWiFi":
		  password: "mypassword"
```

-   적용

```sh
sudo netplan apply
```

### WiFi 설정

-   연결된 와이파이 목록 조회
    -   WIFI_NAME]: ex. `ahope5`, `iptime_5`

```sh
nmcli con show
```

-   네트워크 디바이스명 조회
    -   DEVICE]: ex. `wlp0s20f3`

```sh
nmcli c
```

-   wlp0s20f3` 은 명령어 입력해서 조회
-   숨겨진 네트워크 추가

```sh
nmcli c add type wifi con-name '{WIFI_NAME}' ifname [DEVICE] ssid '{WIFI_NAME}'
nmcli c modify '{WIFI_NAME}' wifi-sec.key-mgmt wpa-psk wifi-sec.psk '{WIFI_PASSWORD}'
```

### 파일 서버

-   설치

```sh
sudo apt install cifs-utils
```

-   인증 정보 저장

```sh
sudo scite /root/ads_cred
# ...
username=xxx
password=yyy

# 권한 설정
sudo chmod 600 /root/ads_cred
```

-   연결

```sh
sudo mkdir /z
sudo scite /etc/fstab
# ...
//172.16.0.74/share	/z	cifs	vers=2.0,credentials=/root/ads_cred,sec=ntlmv2,uid=1000	0	0

# 파일 서버 연결
sudo mount /z
```

### Subversion

-   설치

```sh
sudo apt install subversion
sudo apt install rabbitvcs-nautilus
```

-   체크아웃

```sh
sudo mkdir -p /d/amdm
sudo chown $USER:$USER -R /d
cd /d/amdm
svn checkout https://172.16.0.199/svn/amdm/windows
```

### Rsync

```sh
rsync -av /from/ /to/
rsync -av --delete /from/ /to/
rsync -av --ignore-existing /from/ /to/
# 텍스트 파일로 시뮬레이션 결과 출력
rsync -av  --out-format='%n' --dry-run /from/ /to/ > ~/DIFF_$(date +"%Y%m%d%H%M%S").txt
rsync -av --out-format='%n' --dry-run --exclude='.svn/' --exclude='lib/ahope/*' /from/ /to/ > ~/DIFF_$(date +"%Y%m%d%H%M%S").txt
rsync -av --out-format='%n' --dry-run --exclude-from='exclude.txt' /from/ /to/ > ~/DIFF_$(date +"%Y%m%d%H%M%S").txt
```

-   `-a` : 아카이브 모드 (권한, 소유자, 타임스탬프 보존 등)
-   `-v` : 상세 출력 (무엇이 복사되는지 출력)
-   `--delete`: from 폴더에 없는 파일을 B 폴더에서 삭제
-   `--ignore-existing` : to 폴더에 이미 있는 파일은 무시하고, 없는 파일만 복사
-   `--out-format='%n'` : 파일 이름만 출력
-   `--dry-run` : 실제 복사를 하지 않고, 어떤 파일이 복사될지 시뮬레이션만 수행
-   `--exclude='*.log'`: 특정 파일/폴더 제외
-   `--exclude-from='exclude.txt'`: 여러 패턴을 텍스트 파일로 지정하여 특정 파일/폴더 들을 제외
    ```
    *.log
    .svn
    .svn/*
    lib/ahope
    lib/ahope/*
    ```

---

## Errors

#### apt, apt-get 오류

-   `CASE 1` Could not get lock /var/lib/dpkg/lock-frontend

    ```sh
    sudo killall apt apt-get

    sudo rm /var/lib/apt/lists/lock
    sudo rm /var/cache/apt/archives/lock
    sudo rm /var/lib/dpkg/lock*

    sudo dpkg --configure -a
    ```

-   `CASE 2` E: Release file for http://kr.archive.ubuntu.com/ubuntu/dists/focal-updates/InRelease is not valid yet (invalid for another 48분 5초). Updates for this repository will not be applied.

    ```sh
    sudo hwclock --hctosys
    ```

#### terminator 오류

> ERROR: broadcast 시 값이 두번 입력되는 현상

```sh
sudo vim /usr/share/terminator/terminator
```

-   파일의 내용을 다음과 같이 수정한다.

```py
# /usr/share/terminator/terminator
if __name__ == '__main__':
	# Workaround for IBus intefering with broadcast when using dead keys
	# Environment also needs IBUS_DISABLE_SNOOPER=1, or double chars appear
	# in the receivers.
	username = pwd.getpwuid(os.getuid()).pw_name
	# AS-IS (original)
	# ibus_running = [p for p in psutil.process_iter() if p.name == 'ibus-daemon' and p.username == username]
	# TO-BE (fixed)
	ibus_running = [p for p in psutil.process_iter(['name', 'username']) if p.info['name'] == 'ibus-daemon' and p.info['username'] == username]
	ibus_running = len(ibus_running) > 0
	if ibus_running:
		# AS-IS (original)
	    # os.environ['IBUS_DISABLE_SNOOPER']='1'
		# TO-BE (fixed)
	    os.environ['IBUS_DISABLE_SNOOPER']='0'
```
